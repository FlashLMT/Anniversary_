// A. á€˜á€¬á€á€¬á€•á€¼á€”á€º á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸ (Dictionary)
const translations = {
    'en': {
        'page_title': 'Happy Anniversary! â¤ï¸',
        'nav_brand': 'Our Love Milestone ğŸ’–',
        'card_title': 'Happy Anniversary! ğŸ¥‚',
        'card_text': 'Our 4 Love Milestones (Where Our Hearts Began to Race):', 
        'date_prefix': 'The time our love journey began: <br>',
        'date_suffix': '. ğŸ’',
        
        // Time Difference Text Keys
        'diff_intro': 'We have been together for:',
        'unit_year': 'years',
        'unit_month': 'months',
        'unit_week': 'weeks', 
        'unit_day': 'days',
        'unit_hour': 'hours',
        'unit_minute': 'minutes',
        'unit_second': 'seconds', 
        
        // --- Updated Milestones (Exciting/Emotional) ---
        'm1_title': 'ğŸ—“ï¸ The Beginning (Destinyâ€™s Intersection)', 
        'm1_text': 'The magical day the world stood still and I first saw you. The beautiful start of our love story.',
        'm2_title': 'â˜•ï¸ First Date (The Scent of Love)', 
        'm2_text': 'The day our hearts raced! We got to know each other deeply and realized, this is what love feels like.',
        'm3_title': 'ğŸ’ The Promise (Heart\'s Union)', 
        'm3_text': 'The moment you accepted meâ€”the most crucial step to walk life\'s journey together. There is nothing happier than this.',
        'm4_title': 'âœˆï¸ Favorite Trip (Overflowing Love)', 
        'm4_text': 'Our unforgettable trip away! A time filled with laughter and joy, creating countless memories together.',
        'back_btn': 'Go to Love Page ğŸ '
    },
    // Myanmar Translations
    'my': {
        'page_title': 'á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€–á€½á€šá€º á€”á€¾á€…á€ºá€•á€á€ºá€œá€Šá€ºá€”á€±á€·! â¤ï¸',
        'nav_brand': 'á€™á€±á€¬á€„á€ºá€”á€²á€·á€™á€›á€²á€· á€¡á€á€»á€…á€ºá€™á€¾á€á€ºá€á€­á€¯á€„á€º ğŸ’–',
        'card_title': 'á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€–á€½á€šá€º á€”á€¾á€…á€ºá€•á€á€ºá€œá€Šá€ºá€”á€±á€·! ğŸ¥‚',
        'card_text': 'á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€›á€²á€· á€¡á€á€»á€…á€ºá€™á€¾á€á€ºá€á€­á€¯á€„á€º á„ á€á€¯ (á€›á€„á€ºá€á€¯á€”á€ºá€á€¶á€™á€»á€¬á€¸ á€…á€á€„á€ºá€á€±á€¬ á€”á€±á€·á€›á€€á€º):', 
        'date_prefix': 'á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€¡á€á€»á€…á€ºá€á€›á€®á€¸ á€…á€á€„á€ºá€á€²á€·á€á€²á€· á€¡á€á€»á€­á€”á€º: <br>',
        'date_suffix': ' á€•á€«á‹ ğŸ’',
        
        // Time Difference Text Keys
        'diff_intro': 'á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€· á€¡á€á€°á€á€°á€›á€¾á€­á€á€²á€·á€á€Šá€ºá€· á€¡á€á€»á€­á€”á€ºá€€:',
        'unit_year': 'á€”á€¾á€…á€º',
        'unit_month': 'á€œ',
        'unit_week': 'á€•á€á€º', 
        'unit_day': 'á€›á€€á€º',
        'unit_hour': 'á€”á€¬á€›á€®',
        'unit_minute': 'á€™á€­á€”á€…á€º',
        'unit_second': 'á€…á€€á€¹á€€á€”á€·á€º', 
        
        // --- Updated Milestones (Exciting/Emotional) ---
        'm1_title': 'ğŸ—“ï¸ á€á€½á€±á€·á€†á€¯á€¶á€á€¼á€„á€ºá€¸ á€¡á€… (á€€á€¶á€€á€¼á€™á€¹á€™á€¬á á€†á€¯á€¶á€™á€¾á€á€º)', 
        'm1_text': 'á€€á€™á€¹á€˜á€¬á€€á€¼á€®á€¸ á€á€­á€á€ºá€†á€­á€á€ºá€á€½á€¬á€¸á€•á€¼á€®á€¸ á€™ á€€á€­á€¯ á€•á€‘á€™á€†á€¯á€¶á€¸ á€™á€¼á€„á€ºá€á€½á€±á€·á€á€²á€·á€›á€á€²á€· á€™á€¾á€±á€¬á€ºá€†á€”á€ºá€á€²á€· á€”á€±á€·á€›á€€á€ºá€•á€«á‹ á€¡á€á€»á€…á€ºá€‡á€¬á€á€ºá€œá€™á€ºá€¸á€›á€²á€· á€¡á€…á€•á€²á€œá€±á‹',
        'm2_title': 'â˜•ï¸ á€•á€‘á€™á€†á€¯á€¶á€¸ á€á€»á€­á€”á€ºá€¸á€á€½á€±á€·á€™á€¾á€¯ (á€¡á€á€»á€…á€ºá€›á€²á€· á€›á€”á€¶á€·)', 
        'm2_text': 'á€›á€„á€ºá€á€¯á€”á€ºá€á€¶á€á€½á€± á€—á€œá€±á€¬á€„á€ºá€†á€°á€á€²á€·á€á€²á€· á€”á€±á€·á€œá€±á€¸... á€á€…á€ºá€šá€±á€¬á€€á€ºá€¡á€€á€¼á€±á€¬á€„á€ºá€¸ á€á€…á€ºá€šá€±á€¬á€€á€º á€”á€€á€ºá€”á€€á€ºá€›á€¾á€­á€¯á€„á€ºá€¸á€›á€¾á€­á€¯á€„á€ºá€¸ á€á€­á€á€½á€„á€·á€ºá€›á€á€²á€·á€•á€¼á€®á€¸ á€¡á€á€»á€…á€ºá€†á€­á€¯á€á€¬ á€’á€®á€œá€­á€¯á€•á€«á€œá€¬á€¸á€œá€­á€¯á€· á€”á€¬á€¸á€œá€Šá€ºá€á€²á€·á€›á€á€²á€· á€”á€±á€·á€›á€€á€ºá‹',
        'm3_title': 'ğŸ’ á€‘á€¬á€á€› á€€á€á€­á€€á€á€á€º (á€”á€¾á€œá€¯á€¶á€¸á€á€¬á€¸ á€•á€±á€«á€„á€ºá€¸á€…á€Šá€ºá€¸á€á€¼á€„á€ºá€¸)', 
        'm3_text': 'á€™ á€œá€€á€ºá€á€¶á€á€²á€·á€á€²á€·á€”á€±á€·á€€ á€˜á€á€á€›á€®á€¸á€™á€¾á€¬ á€¡á€á€°á€á€° á€œá€™á€ºá€¸á€œá€»á€¾á€±á€¬á€€á€ºá€–á€­á€¯á€· á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€†á€¯á€¶á€¸ á€†á€¯á€¶á€¸á€–á€¼á€á€ºá€á€»á€€á€ºá€€á€­á€¯ á€á€»á€á€²á€·á€á€²á€· á€¡á€á€­á€¯á€€á€ºá€¡á€á€”á€·á€ºá€•á€«á‹ á€’á€®á€·á€‘á€€á€º á€•á€­á€¯á€•á€»á€±á€¬á€ºá€…á€›á€¬ á€™á€›á€¾á€­á€á€±á€¬á€·á€•á€«á€˜á€°á€¸á‹',
        'm4_title': 'âœˆï¸ á€¡á€•á€»á€±á€¬á€ºá€†á€¯á€¶á€¸ á€á€›á€®á€¸á€…á€‰á€º (á€¡á€á€»á€…á€ºá€á€½á€± á€•á€¼á€Šá€·á€ºá€œá€»á€¾á€¶á€á€¼á€„á€ºá€¸)', 
        'm4_text': 'á€¡á€á€°á€á€° á€›á€šá€ºá€™á€±á€¬á€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€á€²á€·á€›á€á€²á€· á€¡á€á€±á€¸á€›á€±á€¬á€€á€º á€á€›á€®á€¸á€…á€‰á€ºá€œá€±á€¸... á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€›á€²á€· á€¡á€™á€¾á€á€ºá€á€›á€•á€¯á€¶á€›á€­á€•á€ºá€•á€±á€«á€„á€ºá€¸á€™á€»á€¬á€¸á€…á€½á€¬á€€á€­á€¯ á€–á€”á€ºá€á€®á€¸á€á€²á€·á€á€²á€· á€¡á€á€»á€­á€”á€ºá€€á€¬á€œá€œá€±á€¸á€•á€«á‹',
        'back_btn': 'á€á€»á€…á€ºá€á€¼á€„á€ºá€¸á€…á€¬á€¡á€­á€á€ºá€á€­á€¯á€· á€á€½á€¬á€¸á€™á€Šá€º ğŸ '
    }
};

// --- Language Switching Function (no change) ---
function setLanguage(lang) {
    const translation = translations[lang];
    if (!translation) return;
    document.documentElement.setAttribute('data-lang', lang);
    document.title = translation.page_title;
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translation[key]) {
            element.textContent = translation[key];
        }
    });
    const navBrand = document.getElementById('navBrandDate');
    if (navBrand && translation['nav_brand']) {
        navBrand.textContent = translation['nav_brand'];
    }
}


// --- Dynamic Time Difference Logic ---
function calculateTimeDifference(startDateString, lang) {
    const start = new Date(startDateString + 'T00:00:00+06:30'); 
    const now = new Date();
    const translation = translations[lang];
    const timeDifferenceElement = document.getElementById('timeDifferenceDisplay');
    
    let diffMs = now.getTime() - start.getTime();
    
    if (diffMs < 0) {
        timeDifferenceElement.innerHTML = `<span class="diff-intro">${translation.diff_intro}</span> Starting soon! â¤ï¸`;
        return; 
    }
    
    const msInSecond = 1000;
    let totalSeconds = Math.floor(diffMs / msInSecond);
    
    const seconds = totalSeconds % 60;
    totalSeconds = Math.floor(totalSeconds / 60);
    
    const minutes = totalSeconds % 60;
    totalSeconds = Math.floor(totalSeconds / 60);
    
    const hours = totalSeconds % 24;
    let days = Math.floor(totalSeconds / 24); 
    
    const years = Math.floor(days / 365.25);
    days = Math.floor(days % 365.25); 

    const months = Math.floor(days / 30.44); 
    days = Math.floor(days % 30.44); 

    const weeks = Math.floor(days / 7);
    days = days % 7; 
    
    
    let parts = [];
    
    if (years > 0) parts.push(`<strong>${years}</strong> ${translation.unit_year}`);
    if (months > 0) parts.push(`<strong>${months}</strong> ${translation.unit_month}`);
    if (weeks > 0) parts.push(`<strong>${weeks}</strong> ${translation.unit_week}`);
    if (days > 0) parts.push(`<strong>${days}</strong> ${translation.unit_day}`);
    
    parts.push(`<strong>${hours}</strong> ${translation.unit_hour}`);
    parts.push(`<strong>${minutes}</strong> ${translation.unit_minute}`);
    parts.push(`<strong>${seconds}</strong> ${translation.unit_second}`);
    

    if (parts.length === 0) {
        timeDifferenceElement.innerHTML = `<span class="diff-intro">${translation.diff_intro}</span> less than a minute! â¤ï¸`;
    } else {
        const dateParts = parts.slice(0, parts.length - 3).join(', ');
        const timeParts = parts.slice(parts.length - 3).join(', ');
        
        // Using span classes for better styling
        timeDifferenceElement.innerHTML = `
            <span class="diff-intro">${translation.diff_intro}</span> <br> 
            <span class="date-diff-major">${dateParts}</span> <br>
            <span class="date-diff-minor">${timeParts}.</span>
        `;
    }
}


// --- Date Format Logic (DD/MM/YYYY) ---
function formatAnniversaryDate(dateToDisplay, lang) {
    const displayElement = document.getElementById('anniversaryDateDisplay');
    const translation = translations[lang];

    try {
        const dateTimeString = `${dateToDisplay}T12:00:00`; 
        const dateObj = new Date(dateTimeString);
        
        let locale;
        let options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            timeZone: 'Asia/Yangon' 
        };
        
        if (lang === 'my') {
             locale = 'my-MM'; 
        } else {
             locale = 'en-GB'; 
        }
        
        const formattedDateTime = dateObj.toLocaleDateString(locale, options);
        
        displayElement.innerHTML = translation.date_prefix + formattedDateTime + translation.date_suffix;
        
    } catch (e) {
        displayElement.textContent = `${translation.date_prefix} ${dateToDisplay} ${translation.date_suffix}`;
    }
}

// --- Dynamic Background Image List (used for both full page and cards) ---
const backgroundImages = [
    'img/a.jpg', 
    'img/b.jpg', 
    'img/c.jpg', 
    'img/d.jpg'  
];

// --- Full Page Background Animation Logic ---
let currentBgIndex = 0;
let activeLayer = 1;

function cycleBackground() {
    const layer1 = document.getElementById('bg-layer-1');
    const layer2 = document.getElementById('bg-layer-2');
    
    let nextIndex;
    do {
        nextIndex = Math.floor(Math.random() * backgroundImages.length);
    } while (nextIndex === currentBgIndex); 
    
    currentBgIndex = nextIndex;
    const nextImage = backgroundImages[currentBgIndex];

    let currentLayer = (activeLayer === 1) ? layer1 : layer2;
    currentLayer.style.opacity = 0;

    activeLayer = (activeLayer === 1) ? 2 : 1;
    let nextLayer = (activeLayer === 1) ? layer1 : layer2;
    
    nextLayer.style.backgroundImage = `url('${nextImage}')`;
    nextLayer.style.opacity = 1;
}


// --- Page Initialization Logic ---

document.addEventListener('DOMContentLoaded', () => {
    
    const currentLang = sessionStorage.getItem('displayLang') || 'my'; 
    setLanguage(currentLang);
    const dateToDisplay = sessionStorage.getItem('displayDate'); 
    
    if (dateToDisplay) {
        
        formatAnniversaryDate(dateToDisplay, currentLang);
        
        calculateTimeDifference(dateToDisplay, currentLang);
        setInterval(() => {
            calculateTimeDifference(dateToDisplay, currentLang);
        }, 1000); 

        // ğŸŒŸ Milestone Card Backgrounds LOGIC (UPDATED: Random + Fade In) ğŸŒŸ
        const usedIndexes = [];

        document.querySelectorAll('.milestone-card').forEach((card, index) => {
            const bgElement = card.querySelector('.milestone-bg');
            if (bgElement) {
                
                // 1. Random Image á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€á€¼á€„á€ºá€¸ (á€•á€¯á€¶á€™á€»á€¬á€¸ á€‘á€•á€ºá€™á€”á€±á€…á€±á€›á€”á€º á€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€á€Šá€º)
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * backgroundImages.length);
                } while (usedIndexes.includes(randomIndex) && usedIndexes.length < backgroundImages.length);
                
                // 2. á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€¼á€®á€¸á€á€±á€¬ Index á€€á€­á€¯ á€™á€¾á€á€ºá€á€¬á€¸á€á€¼á€„á€ºá€¸
                if (usedIndexes.length < backgroundImages.length) {
                    usedIndexes.push(randomIndex);
                }
                
                // 3. á€•á€¯á€¶á€€á€­á€¯ Background á€¡á€–á€¼á€…á€º á€á€á€ºá€™á€¾á€á€ºá€•á€±á€¸á€á€¼á€„á€ºá€¸
                const randomImagePath = backgroundImages[randomIndex];
                bgElement.style.backgroundImage = `url('${randomImagePath}')`;
                
                // 4. Card Background á€¡á€á€½á€€á€º Fade In Animation á€…á€á€„á€ºá€á€¼á€„á€ºá€¸
                // Card á€á€…á€ºá€á€¯á€•á€¼á€®á€¸á€á€…á€ºá€á€¯ á€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸á€•á€±á€«á€ºá€œá€¬á€…á€±á€›á€”á€º index á€€á€­á€¯ á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€Šá€ºá‹
                setTimeout(() => {
                   bgElement.style.opacity = 1; 
                }, 100 + (index * 300)); 
            }
         });
         
        // ** Full Page Background Animation á€…á€á€„á€ºá€á€¼á€„á€ºá€¸ **
        cycleBackground(); 
        setInterval(cycleBackground, 5000); 

    } else {
        document.getElementById('anniversaryDateDisplay').textContent = "Error: Anniversary date not found. Please go back to the quiz page.";
    }
});
